---
title: awk快速入门
tags: [awk,入门]
comments: true
categories: [awk程序设计语言]
date: 2018-10-23 15:07:26
---
学习《awk程序设计语言》

记录一些平时没使过的小细节。

```
awk '$3 > 0 { print $1, $2, * $3 }' data.txt
```

### awk程序结构
单引号包围的部分是awk语言编写的程序，awk程序常由由一个或多个模式-动作语句组成。

某些语句中，模式可以不存在；动作及其包围它的花括号也可以不存在。经过awk检查后没有语法错误，就会每次读取一个输入行，对读取到的每一行，按顺序检查每一个模式。对每一个与当前行匹配的模式，对应的动作就会执行。一个缺失的模式匹配每一个输入行，只含有模式而没有动作的语句，会打印每一个匹配模式的输入行。

```
pattern { action }
```
可以在一行放置多个语句，语句之间用分号分开。

### 输出
$i表示匹配到的每行第i列（第i个字段）

>$0表示一整行

任何表达式都可以出现在$的后面，用来指明一个字段的编号：表达式被求值，求出的值当作字段的编号。awk计算当前输入行的字段数量，并将它存储在一个内建的变量中，`NF`。

awk将到目前为止，读取到的行数数量保存在内建变量`NR`中。

可以使用`printf`语句进行格式化输出。

```
printf(format, value1, value2, value3, ...., valueN)
```

>`print " "`打印一个空行，单独的`print`打印当前行。

### 选择

```
... '... !($2 < 4 && $3 < 20)   ...'
```
### BEGIN与END

BEGIN在第一个输入文件的第一行之前被匹配，END在最后一个输入文件的最后一行被处理之后匹配。

### 用awk计算

```
 ...
 {pay = pay + $2 * $3}
 ...
```

### 字符串拼接

```
 {names = name $1 " "}
 
 END {print names}
```

### 打印最后一行

```
 {last = $0}
 END {print last}
```

### 内建函数

求平方根、取对数、随机数等。

```
{print $0, length($0)}
```

### 流程控制语句
if-else、循环等，来源于C语言，只能用在动作里。

```
$2 > 6 {n = n + 1; pay = pay + $2 * $3}

END { if (n > 0)
			print n, pay, pay / n
		else 
			print "no result"
}
```

```
{
	i = 1 
	while (i <= $3) {
		printf("\t%.2f\n", $1 * (1 + $2) ^ i)
	}
}
```

```
{ for (i = 1;i <= $3; i = i + 1)	
		printf("\t%.2f\n", $1 * (1 + $2) ^ i)
}
```

### 数组

```
{ line[NR] = $0 }
END { i = NR 
		while (i > 0) {
			print line[i]
			i = i - 1
		}
	}
```



